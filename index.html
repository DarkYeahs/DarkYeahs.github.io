<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="è¿™æ˜¯ä¸€ä¸ªå¾ˆæ‡’çš„äººã€‚ã€‚ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="Yeahs&#39;s Blog">
<meta property="og:url" content="http://blog.yeahs.cc/index.html">
<meta property="og:site_name" content="Yeahs&#39;s Blog">
<meta property="og:description" content="è¿™æ˜¯ä¸€ä¸ªå¾ˆæ‡’çš„äººã€‚ã€‚ã€‚">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yeahs&#39;s Blog">
<meta name="twitter:description" content="è¿™æ˜¯ä¸€ä¸ªå¾ˆæ‡’çš„äººã€‚ã€‚ã€‚">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.yeahs.cc/"/>





  <title>Yeahs's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yeahs's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.yeahs.cc/2017/10/27/event-loopå­¦ä¹ å›é¡¾/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yeahs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yeahs's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/27/event-loopå­¦ä¹ å›é¡¾/" itemprop="url">event loopå­¦ä¹ å›é¡¾</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-27T10:43:01+08:00">
                2017-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/notes/" itemprop="url" rel="index">
                    <span itemprop="name">ç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/27/event-loopå­¦ä¹ å›é¡¾/" class="leancloud_visitors" data-flag-title="event loopå­¦ä¹ å›é¡¾">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»¥å‰äº‹ä»¶é˜Ÿåˆ—åœ¨æˆ‘çš„è®¤çŸ¥èŒƒå›´å†…æ˜¯åªæœ‰ä¸¤ç§ï¼šåŒæ­¥äº‹ä»¶é˜Ÿåˆ—ä¸å¼‚æ­¥äº‹ä»¶é˜Ÿåˆ—ã€‚åœ¨å¤„ç†äº‹ä»¶é˜Ÿåˆ—è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨ä¼šå®šæœŸæ£€æµ‹åŒæ­¥é˜Ÿåˆ—å¹¶ä»åŒæ­¥äº‹ä»¶é˜Ÿåˆ—è·å–äº‹ä»¶ï¼Œå¹¶å°†ä¹‹æ‰§è¡Œï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œå¼‚æ­¥é˜Ÿåˆ—è§¦å‘å›è°ƒäº‹ä»¶æ—¶ï¼Œä¼šå°†å…¶ä»å¼‚æ­¥é˜Ÿåˆ—ä¸­å‡ºé˜Ÿï¼ŒåŠ å…¥åˆ°åŒæ­¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œä¸€ç›´é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚</p>
<p>ä½†åœ¨è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œå½“å¤šä¸ªå¼‚æ­¥äº‹ä»¶é˜Ÿåˆ—åŒæ—¶åˆ°åŒæ­¥é˜Ÿåˆ—è¿‡ç¨‹ä¸­æ˜¯ä»¥ä»€ä¹ˆæ ‡å‡†å»å®ç°çš„ï¼Ÿ</p>
<p>è¿™ä¸ªç–‘é—®ç›´åˆ°å‰æ®µæ—¶é—´çœ‹Vueæœ‰å…³çš„åšå®¢ä¸­æ— æ„é—´çœ‹åˆ°Chunk liuçš„<a href="https://chuckliu.me/#!/posts/58bd08a2b5187d2fb51c04f9" target="_blank" rel="external">Vueæºç è¯¦è§£ä¹‹nextTickï¼šMutationObserveråªæ˜¯æµ®äº‘ï¼Œmicrotaskæ‰æ˜¯æ ¸å¿ƒ</a>æ‰äº†è§£åˆ°microTaskçš„æ¦‚å¿µï¼Œæ‰çŸ¥é“taskçš„åŒºåˆ†ä¸æ˜¯æˆ‘åŸå…ˆç†è§£çš„é‚£ä¹ˆä¸€å›äº‹ã€‚åé¢åˆè¯»äº†Jake Archibald å†™çš„<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="external">Tasksï¼Œ microtasksï¼Œ queues and schedules</a>æ‰çŸ¥é“event loopåˆ°åº•æ˜¯ä¸ªæ€ä¹ˆå›äº‹ã€‚</p>
<p>å…ˆè¯´ä¸‹taskè·ŸmicroTaskçš„æ¦‚å¿µ</p>
<h4 id="task"><a href="#task" class="headerlink" title="task"></a>task</h4><p>task åˆç§° macrotaskã€‚HTML è§„èŒƒä¸­ task çš„æœ‰å…³ç« èŠ‚æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>ä¸€ä¸ª eventloop æœ‰ä¸€æˆ–å¤šä¸ª task é˜Ÿåˆ—ã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªç¡®å®šçš„ task æºæä¾›ã€‚ä»ä¸åŒ task æºè€Œæ¥çš„ task å¯èƒ½ä¼šæ”¾åˆ°ä¸åŒçš„ task é˜Ÿåˆ—ä¸­ã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨å¯èƒ½å•ç‹¬ä¸ºé¼ æ ‡é”®ç›˜äº‹ä»¶ç»´æŠ¤ä¸€ä¸ª task é˜Ÿåˆ—ï¼Œæ‰€æœ‰å…¶ä»– task éƒ½æ”¾åˆ°å¦ä¸€ä¸ª task é˜Ÿåˆ—ã€‚é€šè¿‡åŒºåˆ† task é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ï¼Œä½¿é«˜ä¼˜å…ˆçº§çš„ task ä¼˜å…ˆæ‰§è¡Œï¼Œä¿è¯æ›´å¥½çš„äº¤äº’ä½“éªŒã€‚</p>
</blockquote>
<p>taskæºåŒ…æ‹¬ï¼š</p>
<ul>
<li>DOM æ“ä½œä»»åŠ¡æºï¼šå¦‚å…ƒç´ ä»¥éé˜»å¡æ–¹å¼æ’å…¥æ–‡æ¡£</li>
<li>ç”¨æˆ·äº¤äº’ä»»åŠ¡æºï¼šå¦‚é¼ æ ‡é”®ç›˜äº‹ä»¶ã€‚ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼ˆå¦‚ clickï¼‰ å¿…é¡»ä½¿ç”¨ task é˜Ÿåˆ—</li>
<li>ç½‘ç»œä»»åŠ¡æºï¼šå¦‚ XHR å›è°ƒ</li>
<li>history å›æº¯ä»»åŠ¡æºï¼šä½¿ç”¨ history.back() æˆ–è€…ç±»ä¼¼ API<br>æ­¤å¤– setTimeoutã€setIntervalã€IndexDB æ•°æ®åº“æ“ä½œç­‰ä¹Ÿæ˜¯ä»»åŠ¡æºã€‚</li>
</ul>
<h4 id="microTask"><a href="#microTask" class="headerlink" title="microTask"></a>microTask</h4><p>microTaskï¼šè§„èŒƒä¸Šæ˜¯è¿™ä¹ˆè¯´çš„ï¼šæ¯ä¸ªevent loopéƒ½æœ‰ä¸€ä¸ªmicroTaskï¼Œ microTaskå­˜åœ¨äºmicroTaské˜Ÿåˆ—ä¸­ã€‚<br>microTaskä¸»è¦åˆ†ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>Promise.then</li>
<li>MutationObserver</li>
<li>Object.observe<br>å…¶ä¸­Promise.thenç”±äºä¸åŒæµè§ˆå™¨çš„å®ç°æœ‰æ‰€ä¸åŒï¼Œæœ‰äº›è¿è¡Œè§¦å‘çš„æ˜¯microTaskï¼Œæœ‰äº›è§¦å‘çš„è§¦å‘çš„æ˜¯taskï¼Œä¸è¿‡æ ‡å‡†ä¸Šæ˜¯è§¦å‘microTaskçš„</li>
</ul>
<h4 id="event-loopçš„å¾ªç¯è¿‡ç¨‹"><a href="#event-loopçš„å¾ªç¯è¿‡ç¨‹" class="headerlink" title="event loopçš„å¾ªç¯è¿‡ç¨‹"></a>event loopçš„å¾ªç¯è¿‡ç¨‹</h4><p>åœ¨è¯´äº†taskè·ŸmicroTaskçš„æ¦‚å¿µåå†è¯´ä¸‹event loopçš„å¾ªç¯è¿‡ç¨‹ã€‚å…ˆè´´ä¸€ä¸‹è§„èŒƒçš„è¯´æ³•(æœ‰ç‚¹å‡‘å­—æ•°çš„å«Œç–‘ã€‚ã€‚ã€‚)ï¼š</p>
<blockquote>
<p>An event loop must continually run through the following steps for as long as it exists:</p>
<ol>
<li>Select the oldest task on one of the event loopâ€™s task queues, if any, ignoring, in the case of a browsing context event loop, tasks whose associated Documents are not fully active. The user agent may pick any task queue. If there is no task to select, then jump to the microtasks step below.</li>
<li>Set the event loopâ€™s currently running task to the task selected in the previous step.</li>
<li>Run: Run the selected task.</li>
<li>Set the event loopâ€™s currently running task back to null.</li>
<li>Remove the task that was run in the run step above from its task queue.</li>
<li>Microtasks: Perform a microtask checkpoint. //è¿™é‡Œä¼šæ‰§è¡Œæ‰€æœ‰çš„microtask</li>
<li>Update the rendering: If this event loop is a browsing context event loop (as opposed to a worker event loop), then run the following substeps.<br>7.1 Let now be the value that would be returned by the Performance objectâ€™s now() method.<br>7.2 Let docs be the list of Document objects associated with the event loop in question, sorted arbitrarily except that the following conditions must be met:<br>7.3 If there are top-level browsing contexts B that the user agent believes would not benefit from having their rendering updated at this time, then remove from docs all Document objects whose browsing contextâ€™s top-level browsing context is in B.<br>7.4 If there are a nested browsing contexts B that the user agent believes would not benefit from having their rendering updated at this time, then remove from docs all Document objects whose browsing context is in B.<br>7.5 For each fully active Document in docs, run the resize steps for that Document, passing in now as the timestamp. [CSSOMVIEW]<br>7.6 For each fully active Document in docs, run the scroll steps for that Document, passing in now as the timestamp. [CSSOMVIEW]<br>7.7 For each fully active Document in docs, evaluate media queries and report changes for that Document, passing in now as the timestamp. [CSSOMVIEW]<br>7.8 For each fully active Document in docs, run CSS animations and send events for that Document, passing in now as the timestamp. [CSSANIMATIONS]<br>7.9 For each fully active Document in docs, run the fullscreen rendering steps for that Document, passing in now as the timestamp. [FULLSCREEN]<br>7.10 For each fully active Document in docs, run the animation frame callbacks for that Document, passing in now as the timestamp.<br>7.11 For each fully active Document in docs, run the update intersection observations steps for that Document, passing in now as the timestamp. [INTERSECTIONOBSERVER]<br>7.12 For each fully active Document in docs, update the rendering or user interface of that Document and its browsing context to reflect the current state.<br>If this is a worker event loop (i.e. one running for a WorkerGlobalScope), but there are no tasks in the event loopâ€™s task queues and the WorkerGlobalScope objectâ€™s closing flag is true, then destroy the event loop, aborting these steps, resuming the run a worker steps described in the Web workers section below.<br>Return to the first step of the event loop.</li>
</ol>
</blockquote>
<p>å¤è¿°ä¸€ä¸‹ä¸Šé¢è¯´çš„</p>
<blockquote>
<p>åœ¨å‰5çš„æ­¥éª¤æ˜¯æ‰¾å‡ºå­˜åœ¨taské˜Ÿåˆ—ä¸­æ—¶é—´æœ€é•¿çš„taskï¼Œå‡ºé˜Ÿå¹¶å°†ä¹‹æ‰§è¡Œã€‚<br>åœ¨ç¬¬å…­æ­¥çš„æ—¶å€™å°†microTaské˜Ÿåˆ—ä¸­çš„microTaskå…¨éƒ¨æ‰§è¡Œ<br>ç¬¬ä¸ƒæ­¥ï¼Œæ›´æ–°æ¸²æŸ“ï¼š<br>7.2åˆ°7.4ï¼Œå½“å‰è½®æ¬¡çš„event loopä¸­å…³è”åˆ°çš„documentå¯¹è±¡ä¼šä¿æŒæŸäº›ç‰¹å®šé¡ºåºï¼Œè¿™äº›documentå¯¹è±¡éƒ½ä¼šæ‰§è¡Œéœ€è¦æ‰§è¡ŒUI renderçš„ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰å…³è”åˆ°çš„documentéƒ½éœ€è¦æ›´æ–°UI(æ¢ä¸ªè¯´æ³•å°±æ˜¯åªæœ‰ä»UI Renderæ”¶ç›Šçš„documnetæ‰éœ€è¦æ›´æ–°)ï¼Œæµè§ˆå™¨ä¼šåˆ¤æ–­è¿™ä¸ªdocumentæ˜¯å¦ä¼šä»UI Renderä¸­è·ç›Šï¼Œå› ä¸ºæµè§ˆå™¨åªéœ€è¦ä¿æŒ60Hzçš„åˆ·æ–°ç‡å³å¯ï¼Œè€Œæ¯è½®event loopéƒ½æ˜¯éå¸¸å¿«çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦æ¯ä¸ªdocumentéƒ½Render UIã€‚<br>7.5å’Œ7.6 run the resize steps/run the scroll stepsä¸æ˜¯è¯´å»æ‰§è¡Œresizeå’Œscrollã€‚æ¯æ¬¡æˆ‘ä»¬scollçš„æ—¶å€™è§†å£æˆ–è€…domå°±å·²ç»ç«‹å³scrolläº†ï¼Œå¹¶æŠŠdocumentæˆ–è€…domåŠ å…¥åˆ° pending scroll event targetsä¸­ï¼Œè€Œrun the scroll stepså…·ä½“åšçš„åˆ™æ˜¯éå†è¿™äº›targetï¼Œåœ¨targetä¸Šè§¦å‘scrolläº‹ä»¶ã€‚run the resize stepsä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œè¿™ä¸ªæ­¥éª¤æ˜¯è§¦å‘resizeäº‹ä»¶ã€‚<br>7.8å’Œ7.9 åç»­çš„media query, run CSS animations and send eventsç­‰ç­‰ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯è§¦å‘äº‹ä»¶ï¼Œç¬¬10æ­¥å’Œç¬¬11æ­¥åˆ™æ˜¯æ‰§è¡Œæˆ‘ä»¬ç†Ÿæ‚‰çš„requestAnimationFrameå›è°ƒå’ŒIntersectionObserverå›è°ƒï¼ˆç¬¬åæ­¥è¿˜æ˜¯æŒºå…³é”®çš„,rafå°±æ˜¯åœ¨è¿™æ‰§è¡Œçš„ï¼ï¼‰ã€‚<br>7.12 æ¸²æŸ“UIï¼Œå…³é”®å°±åœ¨è¿™äº†ã€‚<br>ç¬¬ä¹æ­¥ ç»§ç»­æ‰§è¡Œevent loopï¼Œåˆå»æ‰§è¡Œtaskï¼Œmicrotaskså’ŒUI renderã€‚</p>
</blockquote>
<p>ä¸ªäººç†è§£æ˜¯åœ¨event loopè¿‡ç¨‹ä¸­ï¼Œä¼šå¾ªç¯æ£€æµ‹å„ä¸ªtaské˜Ÿåˆ—ä¸­çš„taskï¼Œè·å–åœç•™æ—¶é—´æœ€ä¹…çš„taskï¼Œå‡ºé˜Ÿå¹¶å°†ä¹‹æ‰§è¡Œã€‚åœ¨æ‰§è¡Œå®Œåï¼Œä¼šå»æ£€æµ‹microTaské˜Ÿåˆ—å¹¶æ‰§è¡Œåœ¨è¿™ä¸ªtaskè¿‡ç¨‹ä¸­ç”Ÿæˆçš„microTaskä»¥åŠmicorTaskæ‰§è¡Œè¿‡ç¨‹ä¸­ç”ŸæˆmicroTaskï¼Œåœ¨æ‰§è¡Œå®Œæˆåè¿›è¡Œé¡µé¢çš„æ›´æ–°æ“ä½œã€‚<br>è¿™é‡Œä¸¾ä¸ªğŸŒ°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">console.log(&apos;script start&apos;)</div><div class="line"></div><div class="line">setTimeout(() =&gt; console.log(&apos;setTimeout&apos;), 0)</div><div class="line"></div><div class="line">Promise.resolve().then(() =&gt; console.log(&apos;Promise1&apos;)).then(() =&gt; console.log(&apos;Promise2&apos;))</div><div class="line"></div><div class="line">console.log(&apos;script end&apos;)</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">script start</div><div class="line">script end</div><div class="line">Promise1</div><div class="line">Promise2</div><div class="line">setTimeout</div></pre></td></tr></table></figure></p>
<p>æµè§ˆå™¨é¦–å…ˆæ‰§è¡Œçš„æ˜¯<code>scriptè§£æ</code>çš„<code>task</code>ï¼Œæ‰€ä»¥æœ€å…ˆæ‰“å°çš„æ˜¯åœ¨è¿™ä¸ª<code>task</code>ä¸­æ‰§è¡Œçš„<code>console.log</code>ï¼Œç„¶ååœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>Promise</code>ä¼šç”Ÿæˆäº†ä¸€ä¸ª<code>microTask</code>å¹¶å°†å…¶åŠ å…¥<code>microTask</code>é˜Ÿåˆ—ä¸­ï¼Œ<code>setTimeout</code>ä¼šç”Ÿæˆä¸€ä¸ª<code>task</code>å¹¶å°†å…¶åŠ å…¥<code>task</code>é˜Ÿåˆ—ä¸­ã€‚<br>åœ¨æ‰§è¡Œå®Œ<code>scriptè§£æ</code>è¿™ä¸ª<code>task</code>åï¼Œä¼šå»æ£€æµ‹<code>microTask</code>é˜Ÿåˆ—ï¼Œæ­¤æ—¶<code>microtask</code>é˜Ÿåˆ—ä¸­å­˜åœ¨ä¸€ä¸ªç”±<code>Promise</code>ç”Ÿæˆçš„<code>microTask</code>ä»»åŠ¡ï¼Œå°†å…¶æ‰§è¡Œåå…¶è¿”å›ç»“æœåˆæ‰§è¡Œ<code>then</code>ï¼Œå› æ­¤æœ‰ç”Ÿæˆä¸€ä¸ª<code>microTask</code>ï¼Œå°†å…¶åŠ å…¥åˆ°<code>microTask</code>é˜Ÿåˆ—ä¸­ï¼Œæ‰§è¡Œå®Œæˆåç»§ç»­å°†<code>microTask</code>é˜Ÿåˆ—æ‰§è¡Œå®Œæˆã€‚<br>åœ¨<code>microTask</code>é˜Ÿåˆ—æ‰§è¡Œå®Œæˆåç»§ç»­æ£€æµ‹<code>task</code>é˜Ÿåˆ—ï¼Œæ­¤æ—¶å­˜åœ¨ä¸€ä¸ª<code>setTimeout</code>ç”Ÿæˆçš„<code>task</code>ï¼Œå°†å…¶å®Œæˆåæœ€ç»ˆç»“æœå°±å¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ol>
<li><a href="https://chuckliu.me/#!/posts/58bd08a2b5187d2fb51c04f9" target="_blank" rel="external">Vueæºç è¯¦è§£ä¹‹nextTickï¼šMutationObserveråªæ˜¯æµ®äº‘ï¼Œmicrotaskæ‰æ˜¯æ ¸å¿ƒï¼</a></li>
<li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="external">Tasks, microtasks, queues and schedules</a></li>
<li><a href="https://www.404forest.com/2017/07/18/how-javascript-actually-works-eventloop-and-uirendering/" target="_blank" rel="external">æ·±å…¥æ¢ç©¶ eventloop ä¸æµè§ˆå™¨æ¸²æŸ“çš„æ—¶åºé—®é¢˜ - 404Forest</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.yeahs.cc/2017/10/26/åŒå‘æ•°æ®ç»‘å®šçš„å®ç°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yeahs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yeahs's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/26/åŒå‘æ•°æ®ç»‘å®šçš„å®ç°/" itemprop="url">åŒå‘æ•°æ®ç»‘å®šçš„å®ç°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-26T16:38:18+08:00">
                2017-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/notes/" itemprop="url" rel="index">
                    <span itemprop="name">ç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/26/åŒå‘æ•°æ®ç»‘å®šçš„å®ç°/" class="leancloud_visitors" data-flag-title="åŒå‘æ•°æ®ç»‘å®šçš„å®ç°">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¨¡ä»¿vueçš„åŒå‘æ•°æ®ç»‘å®š"><a href="#æ¨¡ä»¿vueçš„åŒå‘æ•°æ®ç»‘å®š" class="headerlink" title="æ¨¡ä»¿vueçš„åŒå‘æ•°æ®ç»‘å®š"></a>æ¨¡ä»¿vueçš„åŒå‘æ•°æ®ç»‘å®š</h2><blockquote>
<p>å‰æ®µæ—¶é—´å¬äº†TGideasçš„ä¸€åœºäº¤æµä¼šä¹‹åèŒç”Ÿäº†è‡ªå·±å®ç°æ•°æ®åŒå‘ç»‘å®šçš„æƒ³æ³•ï¼Œäºæ˜¯åœ¨å‚è€ƒäº†<a href="https://github.com/DMQ/mvvm" target="_blank" rel="external">DMQ/mvvm: å‰–ævueå®ç°åŸç†ï¼Œè‡ªå·±åŠ¨æ‰‹å®ç°mvvm</a>çš„é€»è¾‘åç”¨TypeScriptå®ç°äº†ä¸€å¥—ç®€å•çš„åŒå‘æ•°æ®ç»‘å®šçš„åº“<br>é¡¹ç›®åœ°å€åœ¨è¿™<a href="https://github.com/DarkYeahs/Yue" target="_blank" rel="external">å­¦ä¹ vueçš„åŒå‘æ•°æ®ç»‘å®š</a></p>
<h4 id="é¡¹ç›®ä¸»è¦ä»£ç ç›®å½•å¦‚ä¸‹"><a href="#é¡¹ç›®ä¸»è¦ä»£ç ç›®å½•å¦‚ä¸‹" class="headerlink" title="é¡¹ç›®ä¸»è¦ä»£ç ç›®å½•å¦‚ä¸‹"></a>é¡¹ç›®ä¸»è¦ä»£ç ç›®å½•å¦‚ä¸‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">src</div><div class="line">|--Yue</div><div class="line">|--|--util</div><div class="line">|--|--|--CompileUtil.ts</div><div class="line">|--|--|--Updater.ts</div><div class="line">|--|--Yue.ts</div><div class="line">|--|--Observer.ts</div><div class="line">|--|--Compile.ts</div><div class="line">|--|--Observer.ts</div><div class="line">|--|--Dep.ts</div><div class="line">|--|--Watcher.ts</div><div class="line">|--index.ts</div></pre></td></tr></table></figure>
<p>æ•´ä¸ªé¡¹ç›®é€šè¿‡srcç›®å½•ä¸‹çš„index.tså¯¹å¤–æš´éœ²å¼•ç”¨ï¼Œä¸»ä½“ç±»æ˜¯Yueç›®å½•ä¸‹çš„Yue.tsã€‚<br>åŒæ—¶Yueç±»ä¸‹é¢è¿˜æœ‰Observer.tsä»¥åŠCompile.tsä¸¤ä¸ªä¸»è¦ç±»ã€‚Observerç±»æ˜¯ç”¨æ¥å»ºç«‹Yueå®ä¾‹åŒ–åå¯¹è±¡ä¸‹çš„dataæ•°æ®çš„ç›‘æµ‹ï¼ŒCompileç±»æ˜¯è´Ÿè´£å°†è‡ªå®šä¹‰çš„ä¸€å¥—htmlè¯­æ³•ç³–ç¼–è¯‘æˆæµè§ˆå™¨æ‰€èƒ½ç†è§£çš„domæ ‘<br>utilç›®å½•ä¸‹å­˜æ”¾ç€CompileUtilä»¥åŠUpdaterä¸¤ä¸ªå·¥å…·ç±»ï¼ŒCompileUtilç±»æ˜¯ç¼–è¯‘å·¥å…·ç±»ï¼ŒUpdateræ˜¯æ•°æ®æ›´æ–°å·¥å…·ç±»</p>
</blockquote>
<h4 id="åŒå‘æ•°æ®ç»‘å®šçš„å®ç°é€»è¾‘"><a href="#åŒå‘æ•°æ®ç»‘å®šçš„å®ç°é€»è¾‘" class="headerlink" title="åŒå‘æ•°æ®ç»‘å®šçš„å®ç°é€»è¾‘"></a>åŒå‘æ•°æ®ç»‘å®šçš„å®ç°é€»è¾‘</h4><blockquote>
<p>å…·ä½“é€»è¾‘å¯ä»¥å‚è€ƒ<a href="https://github.com/DMQ/mvvm" target="_blank" rel="external">DMQ/mvvm: å‰–ævueå®ç°åŸç†ï¼Œè‡ªå·±åŠ¨æ‰‹å®ç°mvvm</a>è¿™ç¯‡æ‰€è®²çš„ï¼Œæˆ‘åªæ˜¯å¤§æ¦‚è®²ä¸€ä¸‹å…³äºè‡ªå·±çš„ç†è§£ã€‚</p>
<ol>
<li>å»ºç«‹å¯¹æ•°æ®çš„ç›‘æµ‹ã€‚åœ¨<code>Observer</code>è¿™ä¸ªç±»ä¸­ä½¿ç”¨<code>Object.defineProperty</code>æ–¹æ³•é‡æ–°å®šä¹‰dataä¸Šçš„æ•°æ®ï¼Œå®ç°å¯¹dataçš„æ•°æ®åŠ«æŒã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ºæ¯ä¸ªå±æ€§èŠ‚ç‚¹å»ºç«‹ä¸€ä¸ªå‘å¸ƒè€…ï¼Œè¿™ä¸ªå‘å¸ƒè€…æ˜¯é’ˆå¯¹å¯¹åº”çš„å±æ€§èŠ‚ç‚¹ä»¥åŠå…¶åä»£å±æ€§çš„ã€‚</li>
<li>æ¨¡ç‰ˆçš„è½¬æ¢ã€‚<ul>
<li>æ¨¡ç‰ˆçš„è·å–ã€‚é€šè¿‡<code>document.createDocumentFragment</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ç¢ç‰‡ï¼Œå¹¶é€šè¿‡appendChildæ–¹æ³•å°†ç¼–è¯‘èŒƒå›´å†…çš„dom&gt;ä»æ–‡æ¡£æ ‘ä¸­ç§»é™¤å¹¶åŠ å…¥åˆ°æ–‡æ¡£ç¢ç‰‡ä¸­ã€‚</li>
<li>æ¨¡ç‰ˆçš„ç¼–è¯‘ã€‚é€šè¿‡<code>node.childNodes</code>é€’å½’éå†æ¯ä¸ªdomèŠ‚ç‚¹ï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨éœ€è¦ç¼–è¯‘çš„æ–‡æœ¬ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™å°†å…¶è·Ÿdataä¸Šçš„æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…å°†å…¶åŠ å…¥åˆ°ç›¸åº”çš„å‘å¸ƒè€…ä¸­ã€‚</li>
</ul>
</li>
<li>é€šè¿‡åœ¨æ•°æ®ç›‘æµ‹ä»¥åŠdomæ•°æ®ç»‘å®šçš„è¿‡ç¨‹æ„å»ºå‘å¸ƒ-è®¢é˜…çš„è®¾è®¡æ¨¡å¼ï¼Œå®ç°äº†åŒå‘æ•°æ®ç»‘å®š</li>
</ol>
</blockquote>
<h4 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h4><blockquote>
<ol>
<li>åœ¨ç¼–è¯‘æ¨¡ç‰ˆä¸­å¤šæ¬¡å¼•ç”¨åŒä¸ªdataä¸Šçš„æ•°æ®ä¼šå¯¼è‡´é‡å¤çš„<code>Watcher</code>åˆ›å»ºã€‚</li>
</ol>
<p>ä¸Šè¿°é—®é¢˜ä»¥åä¼šç»§ç»­ç ”ç©¶ï¼Œå¾…ç»­â€¦</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.yeahs.cc/2017/10/26/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yeahs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yeahs's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/26/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-26T14:28:35+08:00">
                2017-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/notes/" itemprop="url" rel="index">
                    <span itemprop="name">ç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/26/hello-world/" class="leancloud_visitors" data-flag-title="Hello World">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Yeahs" />
            
              <p class="site-author-name" itemprop="name">Yeahs</p>
              <p class="site-description motion-element" itemprop="description">è¿™æ˜¯ä¸€ä¸ªå¾ˆæ‡’çš„äººã€‚ã€‚ã€‚</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/darkyeahs" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yeahschen@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yeahs</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("LtS1G3CyEVi6tgt5ogb2aqQ9-gzGzoHsz", "nmJksmDigo2ERNmkj0spw5MA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  

  

  

  

</body>
</html>
